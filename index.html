<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>Text ↔ PDF Converter • Yasmer PDF</title>
  <meta name="description" content="TXT → PDF and PDF → TXT conversion. Upload your file and download instantly. Free.">

  <!-- Google Search Console verification -->
  <meta name="google-site-verification" content="9DgO4s1UbA0JmVqN1FtmTffUscW_92JFt-85KHFgnLs" />

  <!-- PWA -->
  <meta name="theme-color" content="#0a0b0f">
  <link rel="manifest" href="/manifest.webmanifest">
  <link rel="apple-touch-icon" href="/icons/icon-192.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- SEO -->
  <link rel="canonical" href="https://pdf.yasmerbaski.com/">
  <meta property="og:type" content="website">
  <meta property="og:title" content="Yasmer PDF – TXT → PDF ve PDF → TXT">
  <meta property="og:description" content="TXT → PDF ve PDF → TXT dönüştürme. Ücretsiz, hızlı, PWA.">
  <meta property="og:url" content="https://pdf.yasmerbaski.com/">
  <meta property="og:image" content="https://pdf.yasmerbaski.com/icons/icon-512.png">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Yasmer PDF – TXT ↔ PDF">
  <meta name="twitter:description" content="TXT → PDF ve PDF → TXT dönüştürme. Ücretsiz, hızlı, PWA.">
  <meta name="twitter:image" content="https://pdf.yasmerbaski.com/icons/icon-512.png">

  <!-- Structured Data -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebApplication",
    "name":"Yasmer PDF",
    "url":"https://pdf.yasmerbaski.com/",
    "description":"TXT → PDF ve PDF → TXT dönüştürme. Ücretsiz, hızlı ve mobil uyumlu.",
    "applicationCategory":"UtilityApplication",
    "operatingSystem":"All",
    "inLanguage":["tr","en"]
  }
  </script>

  <style>
    :root{
      --bg:#0a0b0f; --card:#0f1117; --muted:#a6b0c3; --text:#e6e9ef;
      --acc1:#00d084; --acc2:#2dd4bf;
      --border: rgba(255,255,255,.10);
      --pad: clamp(12px, 3vw, 24px);
      --maxw: 980px; --tap: 48px;
    }
    *{box-sizing:border-box} html,body{height:100%} html{-webkit-text-size-adjust:100%}
    body{
      margin:0; color:var(--text);
      font: 16px/1.6 system-ui, -apple-system, Segoe UI, Inter, Arial, sans-serif;
      background:
        radial-gradient(1200px 600px at 20% 0%, rgba(0,208,132,.09), transparent 40%),
        radial-gradient(1000px 600px at 90% 10%, rgba(45,212,191,.08), transparent 35%),
        var(--bg);
    }
    .shell{width:100%; max-width:var(--maxw); margin:0 auto;
      padding: calc(var(--pad) + env(safe-area-inset-top)) var(--pad) var(--pad);}
    header{
      position: sticky; top: 0; z-index: 10;
      display:flex; align-items:center; justify-content:space-between;
      padding: 10px var(--pad);
      margin: calc(-10px - var(--pad)) calc(-1 * var(--pad)) var(--pad);
      backdrop-filter: saturate(160%) blur(8px);
      background: color-mix(in oklab, #0a0b0f 86%, transparent);
      border-bottom: 1px solid var(--border);
    }
    .logo{display:flex; align-items:center; gap:10px; font-weight:800; letter-spacing:.2px}
    .logo span{background:linear-gradient(90deg,var(--acc1),var(--acc2)); -webkit-background-clip:text; color:transparent}
    .flags{display:flex; gap:10px; margin-left:auto}
    .flag{cursor:pointer; padding:0; border:0; background:transparent;
      width:32px; height:22px; border-radius:4px; overflow:hidden; filter:grayscale(60%)}
    .flag.active{filter:none; box-shadow:0 0 0 2px rgba(255,255,255,.28) inset}
    .flag svg{display:block; width:100%; height:100%}
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.025));
      border:1px solid var(--border);
      border-radius:16px; padding: clamp(14px, 2.5vw, 22px);
      box-shadow:0 10px 40px rgba(0,0,0,.35); backdrop-filter: blur(6px);
    }
    .grid{display:grid; gap: clamp(14px, 3.2vw, 24px);
      grid-template-columns: 1fr; grid-template-areas:"side" "main";}
    .main{grid-area: main} .side{grid-area: side; display:flex; flex-direction:column; gap:12px}
    @media (min-width: 860px){
      .grid{grid-template-columns: 1.2fr .8fr; grid-template-areas:"main side"}
      .side{gap:14px}
    }
    h1{margin:6px 0 6px; font-size: clamp(22px, 3.2vw, 28px)}
    p.sub{margin:0 0 14px; color:var(--muted)}
    textarea{width:100%; min-height: 220px; padding:12px 14px; border-radius:12px;
      border:1px solid rgba(255,255,255,.12); background:#0c0e13; color:var(--text);
      outline:none; box-shadow: inset 0 0 0 1px rgba(0,0,0,.2); font-size:16px}
    @media (min-width: 860px){ textarea{ min-height: 300px } }
    .actions{display:flex; gap:10px; flex-wrap:wrap; margin-top:10px}
    .actions > *{ flex:1 1 180px; min-height: var(--tap) }
    button,.ghost{border:0; border-radius:12px; padding:12px 16px; font-weight:700; cursor:pointer}
    .primary{background:linear-gradient(90deg,var(--acc1),var(--acc2)); color:#072315}
    .ghost{background:transparent; color:var(--text); border:1px dashed rgba(255,255,255,.25)}
    .panel{border:1px solid rgba(255,255,255,.12); border-radius:12px; padding:12px; background:#0c0e13}
    .panel label{display:block; font-size:14px; color:var(--muted); margin-bottom:6px}
    select,input[type="text"]{width:100%; padding:12px; min-height: var(--tap);
      border-radius:10px; border:1px solid rgba(255,255,255,.15); background:#0b0d12; color:var(--text); font-size:16px}
    .drop{border:1.5px dashed rgba(255,255,255,.25); border-radius:12px; padding:16px; text-align:center;
      background:rgba(255,255,255,.02); min-height: var(--tap)}
    .drop.drag{border-color:var(--acc1); background:rgba(0,208,132,.07)}
    .muted{color:var(--muted); font-size:14px}
    footer{margin:14px 0 0; padding-bottom: calc(env(safe-area-inset-bottom));
      color:var(--muted); font-size:13px; text-align:center}
  </style>
</head>
<body>
  <div class="shell">
    <header>
      <div class="logo"><strong>Yasmer <span>PDF</span></strong></div>
      <div class="flags">
        <button id="flag-en" class="flag active" aria-label="English">
          <svg viewBox="0 0 60 40"><clipPath id="ukc"><rect width="60" height="40" rx="2"/></clipPath>
            <g clip-path="url(#ukc)"><rect width="60" height="40" fill="#012169"/>
              <path d="M0,0 60,40 M60,0 0,40" stroke="#fff" stroke-width="8"/>
              <path d="M0,0 60,40 M60,0 0,40" stroke="#C8102E" stroke-width="4"/>
              <rect x="26" width="8" height="40" fill="#fff"/>
              <rect y="16" width="60" height="8" fill="#fff"/>
              <rect x="28" width="4" height="40" fill="#C8102E"/>
              <rect y="18" width="60" height="4" fill="#C8102E"/></g></svg>
        </button>
        <button id="flag-tr" class="flag" aria-label="Türkçe">
          <svg viewBox="0 0 60 40">
            <rect width="60" height="40" rx="2" fill="#E30A17"/>
            <circle cx="26" cy="20" r="10" fill="#fff"/>
            <circle cx="28.8" cy="20" r="8" fill="#E30A17"/>
            <path d="M38 20 l7 -4 l-2.7 8.3 l-2.7 -8.3 l7 4 l-8.6 0" fill="#fff"/>
          </svg>
        </button>
      </div>
    </header>

    <div class="card">
      <div class="grid">
        <div class="main">
          <h1 id="title">TXT → PDF</h1>
          <p class="sub" id="subtitle">Type/paste text or drop a <b>.txt</b> file in the box on the right.</p>

          <form id="f">
            <textarea name="text" id="text" placeholder="Type your text here..."></textarea>
            <div class="actions">
              <button class="primary" type="submit" id="actionBtn">Create & Download PDF</button>
              <button class="ghost" type="button" id="clearBtn">Clear</button>
            </div>
          </form>

          <p class="muted" id="hint">In PDF → TXT mode, the extracted text appears here and downloads as .txt.</p>
          <button id="installBtn" class="ghost" style="margin-top:10px; display:none">Uygulamayı Yükle</button>
        </div>

        <div class="side">
          <div class="panel">
            <label for="mode" id="modeLabel">Conversion Mode</label>
            <select id="mode">
              <option value="txt2pdf">TXT → PDF</option>
              <option value="pdf2txt">PDF → TXT</option>
            </select>
          </div>

          <div class="panel">
            <label id="uploadLabel">Upload (Drag & Drop)</label>
            <div id="drop" class="drop" role="button" tabindex="0">
              <strong id="acceptLabel">.txt</strong> <span id="dropText">drop your file here</span><br/>
              <span class="muted" id="orClick">or click to choose</span>
              <input id="file" type="file" accept=".txt,text/plain" hidden>
            </div>
            <div style="margin-top:10px" class="muted" id="fileInfo"></div>
          </div>

          <div class="panel">
            <label id="outLabel">Output Filename (optional)</label>
            <input type="text" id="outName" placeholder="e.g. my-file">
            <div class="muted" id="outHint">Extension is added automatically (.pdf / .txt)</div>
          </div>
        </div>
      </div>
    </div>

    <footer>© <span id="y"></span> Yasmer PDF • Hosted on Vercel</footer>
  </div>

  <!-- A2HS + SW register -->
  <script>
    let deferredPrompt; const installBtn = document.getElementById('installBtn');
    window.addEventListener('beforeinstallprompt', (e)=>{ e.preventDefault(); deferredPrompt = e; installBtn.style.display='inline-block'; });
    installBtn?.addEventListener('click', async ()=>{ installBtn.style.display='none'; deferredPrompt?.prompt(); deferredPrompt = null; });

    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js', { scope: '/' }).catch(err => console.error('SW register failed', err));
      });
    }
  </script>

  <!-- App JS (drop-fix uygulanmış tam sürüm) -->
  <script>
  /* ==================== i18n ==================== */
  const I18N = {
    en:{title_txt2pdf:"TXT → PDF",title_pdf2txt:"PDF → TXT",
        sub_txt2pdf:'Type/paste text or drop a <b>.txt</b> file in the box on the right.',
        sub_pdf2txt:'Drop a <b>.pdf</b> file in the box on the right; we’ll extract its text.',
        action_txt2pdf:"Create & Download PDF",action_pdf2txt:"Extract & Download (.txt)",
        clear:"Clear",hint:"In PDF → TXT mode, the extracted text appears here and downloads as .txt.",
        modeLabel:"Conversion Mode",uploadLabel:"Upload (Drag & Drop)",dropText:"drop your file here",
        orClick:"or click to choose",accept_txt:".txt",accept_pdf:".pdf",
        outLabel:"Output Filename (optional)",outHint:"Extension is added automatically (.pdf / .txt)",
        ph_txt:"Type your text here...",alerts:{txtOnly:"Please upload a .txt file.",
        pdfOnly:"Please upload a .pdf file.",emptyText:"Text is empty.",serverError:"Server error",
        extractFail:"Failed to extract text",tooBig:"File is too large (≤ 4 MB recommended)."}},
    tr:{title_txt2pdf:"TXT → PDF",title_pdf2txt:"PDF → TXT",
        sub_txt2pdf:"Metni yaz / yapıştır ya da sağdaki kutuya <b>.txt</b> dosyası bırak.",
        sub_pdf2txt:"Sağdaki kutuya <b>.pdf</b> dosyasını bırak; metnini çıkaralım.",
        action_txt2pdf:"PDF Oluştur ve İndir",action_pdf2txt:"Metni Çıkar ve İndir (.txt)",
        clear:"Temizle",hint:"PDF → TXT modunda yüklediğin PDF’in metnini burada görebilir ve .txt olarak indirebilirsin.",
        modeLabel:"Dönüştürme Modu",uploadLabel:"Dosya Yükle (Sürükle & Bırak)",dropText:"dosyanı buraya bırak",
        orClick:"veya tıkla seç",accept_txt:".txt",accept_pdf:".pdf",
        outLabel:"Çıktı Dosya Adı (opsiyonel)",outHint:"Uzantı otomatik eklenir (.pdf / .txt)",
        ph_txt:"Metni buraya yaz...",alerts:{txtOnly:"Lütfen .txt dosyası yükleyin.",
        pdfOnly:"Lütfen .pdf dosyası yükleyin.",emptyText:"Metin boş.",serverError:"Sunucu hatası",
        extractFail:"Metin çıkarılamadı",tooBig:"Dosya çok büyük (≤ 4 MB önerilir)."}}
  };

  const $ = id => document.getElementById(id);
  const flagEn=$("flag-en"), flagTr=$("flag-tr");
  const form=$("f"), txt=$("text"), clearBtn=$("clearBtn"),
        drop=$("drop"), fileInput=$("file"), fileInfo=$("fileInfo"),
        modeSel=$("mode"), titleEl=$("title"), subtitle=$("subtitle"),
        acceptLabel=$("acceptLabel"), outName=$("outName"),
        actionBtn=$("actionBtn"), hint=$("hint"),
        modeLabel=$("modeLabel"), uploadLabel=$("uploadLabel"),
        dropText=$("dropText"), orClick=$("orClick"),
        outLabel=$("outLabel"), outHint=$("outHint");

  document.getElementById('y').textContent=new Date().getFullYear();

  let lang="en";
  function getMode(){ return (modeSel?.value)||'txt2pdf'; } // HER ZAMAN select'ten oku

  // Dil seçimi
  flagEn?.addEventListener('click',()=>setLang("en"));
  flagTr?.addEventListener('click',()=>setLang("tr"));
  function setLang(l){ lang=l; flagEn?.classList.toggle("active",l==="en"); flagTr?.classList.toggle("active",l==="tr"); applyI18N(); }

  // UI metinleri
  function applyI18N(){
    const T = I18N[lang]; const m = getMode();
    modeLabel.textContent=T.modeLabel; uploadLabel.textContent=T.uploadLabel;
    dropText.textContent=T.dropText; orClick.textContent=T.orClick;
    outLabel.textContent=T.outLabel; outHint.textContent=T.outHint;

    if(m==='txt2pdf'){
      titleEl.textContent=T.title_txt2pdf; subtitle.innerHTML=T.sub_txt2pdf;
      acceptLabel.textContent=T.accept_txt; fileInput.accept='.txt,text/plain';
      actionBtn.textContent=T.action_txt2pdf; txt.placeholder=T.ph_txt;
    }else{
      titleEl.textContent=T.title_pdf2txt; subtitle.innerHTML=T.sub_pdf2txt;
      acceptLabel.textContent=T.accept_pdf; fileInput.accept='.pdf,application/pdf';
      actionBtn.textContent=T.action_pdf2txt;
      txt.placeholder=(lang==="en"?"Extracted text will appear here...":"Çıkarılan metin burada görünecek...");
    }
    clearBtn.textContent=I18N[lang].clear;
  }
  applyI18N();

  // Mod değişimi
  modeSel?.addEventListener('change',()=>{
    txt.value=''; fileInfo.textContent=''; outName.value='';
    applyI18N();
  });

  // Form
  form?.addEventListener('submit', async (e)=>{
    e.preventDefault();
    const base=(outName.value || (getMode()==='txt2pdf'?'text':'extracted')).trim();
    if(getMode()==='txt2pdf'){ await createPdf(txt.value, base); }
    else{ if(!txt.value.trim()) alert(I18N[lang].alerts.emptyText); }
  });

  // Temizle
  clearBtn?.addEventListener('click',()=>{
    txt.value=''; fileInfo.textContent=''; outName.value='';
  });

  // Drag & Drop
  drop?.addEventListener('click',()=> fileInput.click());
  ['dragenter','dragover'].forEach(ev=> drop?.addEventListener(ev,e=>{
    e.preventDefault(); e.stopPropagation(); drop.classList.add('drag');
  }));
  ['dragleave','drop'].forEach(ev=> drop?.addEventListener(ev,e=>{
    e.preventDefault(); e.stopPropagation(); drop.classList.remove('drag');
  }));
  drop?.addEventListener('drop',(e)=>{
    const file=e.dataTransfer.files?.[0]; if(file) handleFile(file);
  });
  fileInput?.addEventListener('change',()=>{
    const file=fileInput.files?.[0]; if(file) handleFile(file);
  });

  // Dosya işleme (FIX'li)
  function handleFile(file){
    const T=I18N[lang].alerts;
    if(file.size > 4*1024*1024){ alert(T.tooBig); return; }

    const m = getMode();
    if(m==='txt2pdf'){
      if(!/\.txt$/i.test(file.name)) return alert(T.txtOnly);
      const reader=new FileReader();
      reader.onload=()=>{
        txt.value=reader.result;
        const base=(outName.value || file.name.replace(/\.txt$/i,'') || 'text');
        fileInfo.textContent=`→ ${base}.pdf`;
        createPdf(txt.value, base);
      };
      reader.readAsText(file);
    }else{ // pdf2txt
      if(!/\.pdf$/i.test(file.name)) return alert(T.pdfOnly);
      const base=(outName.value || file.name.replace(/\.pdf$/i,'') || 'extracted');
      fileInfo.textContent=`→ ${base}.txt`;
      extractTextFromPdf(file, base);
    }
  }

  // TXT→PDF (server)
  async function createPdf(text, baseName){
    const T=I18N[lang].alerts;
    if(!text.trim()){ alert(T.emptyText); return; }
    actionBtn.disabled=true; actionBtn.textContent=(lang==='en'?'Creating...':'Oluşturuluyor...');
    try{
      const res=await fetch('/api/make-pdf',{
        method:'POST', headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ text, filename: baseName + '.pdf' })
      });
      if(!res.ok){
        let msg=T.serverError; try{ const j=await res.json(); msg=j.error||msg; }catch{}
        throw new Error(msg);
      }
      const blob=await res.blob(); const url=URL.createObjectURL(blob);
      const a=document.createElement('a'); a.href=url; a.download=baseName + '.pdf'; a.click(); URL.revokeObjectURL(url);
    }catch(err){ alert('PDF: ' + err.message); }
    finally{ actionBtn.disabled=false; applyI18N(); }
  }

  // PDF→TXT (server)
  async function extractTextFromPdf(file, baseName){
    const T=I18N[lang].alerts;
    actionBtn.disabled=true; actionBtn.textContent=(lang==='en'?'Extracting...':'Çıkarılıyor...');
    try{
      const arrayBuf=await file.arrayBuffer();
      const res=await fetch('/api/pdf-to-txt',{ method:'POST', headers:{'Content-Type':'application/pdf'}, body: arrayBuf });
      if(!res.ok){
        let msg=T.serverError; try{ const j=await res.json(); msg=j.error||msg; }catch{}
        throw new Error(msg);
      }
      const textRes=await res.text(); txt.value=textRes;
      const blob=new Blob([textRes],{type:'text/plain;charset=utf-8'});
      const url=URL.createObjectURL(blob); const a=document.createElement('a');
      a.href=url; a.download=baseName + '.txt'; a.click(); URL.revokeObjectURL(url);
    }catch(err){ alert(I18N[lang].alerts.extractFail + ': ' + err.message); }
    finally{ actionBtn.disabled=false; applyI18N(); }
  }
  </script>
</body>
</html>
